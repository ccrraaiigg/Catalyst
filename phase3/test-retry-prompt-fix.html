<!DOCTYPE html>
<html>
<head>
    <title>Test Retry Prompt Fix</title>
    <script type="module">
        import { SqueakVM } from './dist/squeak-vm.js';
        
        async function testRetryPromptWithWASMAnalysis() {
            console.log('üß™ Testing retry prompt fix with WASM analysis...');
            
            const vm = new SqueakVM();
            vm.setDebugMode(true);
            
            try {
                await vm.initialize();
                console.log('‚úÖ VM initialized successfully');
                
                // Enable LLM optimization to trigger retry prompts
                // This will use mock mode since no API key is configured
                vm.configureLLM({
                    enabled: true,
                    apiKey: 'mock-key',
                    endpoint: 'http://localhost:8001/api/openai',
                    model: 'gpt-4',
                    provider: 'openai'
                });
                
                console.log('üöÄ Running VM to trigger JIT compilation...');
                const result = await vm.run();
                console.log('‚úÖ VM run completed:', result);
                
                const stats = vm.getJITStatistics();
                console.log('üìä JIT Stats:', stats);
                
                if (stats.llmAttempts > 0) {
                    console.log('üéØ LLM optimization was attempted - retry prompts should now include WASM analysis');
                    console.log('üìù Check the console logs above for "WASM ANALYSIS & DUMP:" in retry prompts');
                } else {
                    console.log('‚ÑπÔ∏è No LLM optimization attempts - this is normal in mock mode');
                }
                
                document.getElementById('result').innerHTML = `
                    <h3>‚úÖ Test Complete</h3>
                    <p><strong>Result:</strong> ${JSON.stringify(result)}</p>
                    <p><strong>JIT Stats:</strong> ${JSON.stringify(stats, null, 2)}</p>
                    <p><strong>LLM Attempts:</strong> ${stats.llmAttempts}</p>
                    <p><strong>Retry Fix:</strong> The retry prompts should now include WASM analysis information</p>
                    <p><strong>Check Console:</strong> Look for "WASM ANALYSIS & DUMP:" in the console logs</p>
                `;
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                document.getElementById('result').innerHTML = `
                    <h3>‚ùå Test Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check the console for more details</p>
                `;
            }
        }
        
        // Run test when page loads
        window.addEventListener('load', testRetryPromptWithWASMAnalysis);
    </script>
</head>
<body>
    <h1>Test Retry Prompt Fix</h1>
    <p>This test verifies that retry prompts now include WASM analysis information.</p>
    <div id="result">
        <p>Running test...</p>
    </div>
</body>
</html> 