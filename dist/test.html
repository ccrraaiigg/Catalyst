<!DOCTYPE html>
<html>
<head>
    <title>SqueakJS WASM VM Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f8ff; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe0e0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    </style>
</head>
<body bgColor='gray'>
    <h1>SqueakJS WASM VM Test</h1>
    <p>This page tests the minimal SqueakJS WASM VM with a (3 squared) example.</p>
    
    <button id="runTest">Run (3 squared) Test</button>
    <button id="clearResults">Clear Results</button>
    
    <div id="output"></div>

    <script src="squeak-vm.js"></script>
    <script>
        let vm = null;
        const output = document.getElementById('output');

        async function initVM() {
            if (!vm) {
                vm = new SqueakWASMVM();
                const success = await vm.initialize();
                if (!success) {
                    throw new Error('Failed to initialize VM');
                }
            }
        }

        document.getElementById('runTest').addEventListener('click', async () => {
            try {
                await initVM();
                
                const startTime = performance.now();
                const results = await vm.runMinimalExample();
                const endTime = performance.now();
                
                const div = document.createElement('div');
                div.className = 'result';
                div.innerHTML = `
                    <strong>Test Result:</strong> ${results.join(', ')}<br>
                    <strong>Expected:</strong> 7<br>
                    <strong>Status:</strong> ${results.includes(7) ? '✓ PASS' : '✗ FAIL'}<br>
                    <strong>Execution Time:</strong> ${(endTime - startTime).toFixed(2)}ms
                `;
                output.appendChild(div);
            } catch (error) {
                const div = document.createElement('div');
                div.className = 'error';
                div.innerHTML = `<strong>Error:</strong> ${error.message}`;
                output.appendChild(div);
            }
        });

        document.getElementById('clearResults').addEventListener('click', () => {
            output.innerHTML = '';
        });
    </script>
</body>
</html>